#pragma once

struct cnn_dist_v14 {

	static const float w0[2][1][1] = {{{0.6784594}},{{0.8001581}}};
	static const float b0[1] = {0.0};

	static const float w1[2][1][1] = {{{0.43327922}},{{0.5530075}}};
	static const float b1[1] = {0.0};

	static const float w2[2][4][1] = {{{0.82105666,0.9939897,-0.6992494,1.0596873}},{{-0.40247163,0.02788179,0.22029272,0.43079022}}};
	static const float b2[4] = {0.0};

	static const float w3[2][4][4] = {{{-0.096562244,0.043686572,0.29736635,0.1008114},{-0.30820298,-0.33423805,0.18173191,-0.19184273},{0.0064438023,0.16140796,0.2895252,0.0756172},{-0.6232572,0.18780205,-0.07955435,0.030294284}},{{-0.16656145,0.19933991,-0.33006585,0.39004394},{0.27235034,0.002526508,-1.0594902,0.8986806},{-0.0025985097,0.15282343,0.26915258,-0.5948178},{-0.1551098,-0.05487978,-0.68777174,0.6780987}}};
	static const float b3[4] = {0.0,0.0,0.0,0.0};

	static const float w4[2][4][4] = {{{0.13925318,0.020985529,-0.17277421,-0.2545646},{-0.1122741,0.23016213,-0.03921453,-0.35336402},{-0.35345706,-0.24575858,-0.42385334,-0.23871386},{0.036930386,0.40964967,0.3287844,-0.18129526}},{{-0.28078705,-0.24399593,-0.43697003,0.20232126},{0.04834626,-0.2352286,0.09344339,-0.057745844},{-0.7417792,0.44068295,0.2749874,0.2698999},{0.9054384,-0.4208279,-0.24422243,0.3580634}}};
	static const float b4[4] = {0.0,0.0,0.0,0.0};

	static const float w5[2][4][4] = {{{0.007897774,0.37790266,0.39075828,-0.55630964},{-0.018066896,0.02473875,-0.2935814,-0.0068107517},{0.22090372,0.12397751,0.066027276,-0.18940918},{0.16816694,-0.13177437,0.1336108,-0.16480783}},{{0.6978369,-0.47306395,0.42943197,0.3146012},{-0.26038092,0.4536124,-0.33165383,-0.36100122},{-0.30053565,-0.1893293,0.4216952,-0.64304924},{0.39572087,0.21453702,0.29250148,0.11756737}}};
	static const float b5[4] = {0.0,0.0,0.0,0.0};

	static const float w6[2][4][4] = {{{0.6165027,0.48446688,-0.48845866,-0.07146478},{-0.36926383,-0.35306832,0.6555418,0.19391014},{0.24736619,0.13843197,-0.1919004,0.27973676},{0.5302789,0.48547265,-0.5445021,-0.35241622}},{{-0.397821,0.062904954,0.040552437,0.008200748},{0.0437215,0.19865276,0.079257555,0.50658655},{-0.4854628,-0.1563093,0.43103656,0.02024316},{0.42988002,0.329283,-0.615772,-0.6195978}}};
	static const float b6[4] = {0.0,0.0,0.0,0.0};

	static const float w7[2][4][4] = {{{-0.80891657,0.38983244,0.4900158,-0.42743307},{-0.4064443,0.061480053,0.011620728,-0.2750919},{0.25668287,-0.035054266,-0.46837908,0.0848388},{-0.26528603,0.48670384,-0.14385529,0.05662081}},{{-0.6512544,0.63047326,0.4584406,-0.7086217},{-0.47237605,0.24052042,0.0521495,0.013970743},{0.2624744,-0.28788126,-0.6831473,0.28725165},{0.047077637,-0.1940987,-0.3640369,0.23503856}}};
	static const float b7[4] = {0.0,0.0,0.0,0.0};

	static const float w8[1][6][4] = {{{-0.5177265,-0.14975534,-0.6015556,-0.47990215,-0.528971,0.6481736},{0.56499505,0.40930143,0.03412552,0.46233514,0.4369466,-0.54185647},{0.21744893,0.3166521,-0.24856079,1.1452522,0.5269436,-0.1328209},{-0.2094076,-0.08579066,-0.03669667,-0.78367853,0.57403404,0.5193505}}};
	static const float b8[6] = {-0.20853913,-0.5333103,0.064143024,0.24081539,-0.4177996,-0.03428339};

	static const float w9[1][6][6] = {{{0.53543717,0.37499622,0.0075039184,0.31498256,0.011358716,-0.4457546},{0.3070872,-0.011432934,-0.22523995,0.45817572,0.15588479,-0.62005746},{0.2541894,-0.07169665,0.5539768,0.1495336,-0.19737063,-0.32259747},{0.02440596,0.40427554,0.52878106,0.7355708,-0.59672886,-0.0654044},{0.29773602,0.47393417,-0.023686066,-0.024772637,-0.30945602,-0.6429625},{-0.33115652,-0.20079447,-0.41035882,-0.64758724,0.42538732,0.079398856}}};
	static const float b9[6] = {0.30921215,0.14733276,0.5379279,0.22166498,0.08200599,0.19095652};

	static const float w10[1][6][6] = {{{0.04463872,0.60415757,0.59067535,0.8128065,0.03109768,0.51051724},{0.34836277,0.3467357,0.076875895,0.18205236,-0.38904732,0.42012292},{-0.18547696,0.33887434,-0.25983545,0.87068576,-0.23270704,-0.30957133},{0.5358817,0.542994,0.43435663,0.76302797,-0.5380214,-0.15548961},{-0.25326183,-0.07821349,-0.26038367,-0.10253669,0.58380765,0.020334354},{-0.6455411,-0.073750414,-0.7293658,-0.18291152,0.46198085,-0.7227694}}};
	static const float b10[6] = {-0.16648489,-0.1955559,-0.2938515,0.5018599,-0.11389267,-0.20178783};

	static const float w11[1][6][6] = {{{0.6343012,0.13971859,0.5610295,0.04176965,0.24481797,-0.06940725},{0.15796727,-0.27251723,0.46598852,0.0335323,0.19010642,-0.22330306},{0.6577295,0.06289207,0.5671732,0.61338353,0.11619451,0.35944936},{-0.25381073,-0.62966,0.39575654,-0.20192805,-0.75758445,0.6400466},{-0.46514037,0.59773606,-0.67906654,-0.55953205,0.43447927,0.4118749},{0.4053641,-0.16426687,0.43718755,0.20641325,-0.036911327,0.1297273}}};
	static const float b11[6] = {0.23800264,-0.3971971,0.03556902,0.06519038,0.015024988,0.033749726};

	static const float w12[1][4][6] = {{{-0.06815303,-0.48452187,-0.026077768,0.40594357},{-0.4102812,0.06736673,0.28285408,-0.25809357},{-0.4276312,-0.6229278,0.262979,0.49543884},{-0.053968135,-0.5438239,-0.12158669,0.2562999},{-0.32504502,-0.2719919,0.37531826,-0.20876327},{0.37033406,-0.13259475,-0.16542445,0.12935299}}};
	static const float b12[4] = {-0.17327817,-0.38591734,0.19706228,-0.1822062};

	static const float w13[2][4][4] = {{{0.29325145,-0.20352922,0.054487616,0.04947464},{-0.2915612,-0.16010053,-0.022726197,0.34410453},{-0.31445208,0.012832388,-0.018488534,-0.09400587},{0.53643805,0.08770453,-0.26554617,-0.1283611}},{{0.1483958,0.45884913,-0.47767538,0.15463637},{0.107343465,0.5594031,-0.49314496,0.18837075},{-0.19698088,-0.2944935,-0.10129072,0.08740139},{0.3338226,-0.20683162,0.4822617,-0.03267058}}};
	static const float b13[4] = {0.0,0.0,0.0,0.0};

	static const float w14[2][4][4] = {{{0.032096002,0.28984097,0.14320992,0.33610263},{-0.17947666,-0.19991574,0.035295434,-0.22638385},{0.035167314,0.21528704,-0.030988792,0.3517564},{0.17319351,-0.13880071,-0.19010893,-0.13493492}},{{0.33388126,0.38656655,0.14022934,0.032136813},{-0.40170118,0.36673155,-0.37254614,0.07246641},{0.33951324,-0.535464,0.36886132,0.3295573},{-0.54867685,0.0013274344,-0.21505995,-0.3176015}}};
	static const float b14[4] = {0.0,0.0,0.0,0.0};

	static const float w15[2][4][4] = {{{-0.17615359,-0.039022923,-0.29828605,0.12523033},{0.058460463,-0.31124485,0.0105441,0.19672838},{-0.045790203,0.09147055,-0.012158926,0.043970782},{-0.16671124,-0.13140115,-0.5593165,0.25729817}},{{0.4936331,-0.455337,-0.19842054,-0.29162398},{-0.67062324,-0.32568765,0.0500022,0.4113434},{0.29419002,-0.20322266,-0.42011952,-0.4388803},{0.20467137,-0.041068252,-0.26030153,-0.08382562}}};
	static const float b15[4] = {0.0,0.0,0.0,0.0};

	static const float w16[2][4][4] = {{{-0.028840875,0.15409555,-0.34052542,0.074375324},{0.46949452,-0.07975208,0.25527668,-0.20186739},{0.3696052,0.13746813,0.38574427,0.07657493},{0.25721744,0.14556429,0.32091966,-0.13573454}},{{0.5829862,-0.58412933,0.12525319,0.62143993},{-0.24204978,0.051242646,0.31982642,-0.00840657},{-0.25529432,0.18951313,0.018092897,-0.3520381},{-0.46138582,0.13133173,-0.4344083,-0.2628948}}};
	static const float b16[4] = {0.0,0.0,0.0,0.0};

	static const float w17[2][1][4] = {{{0.450194},{-0.37431854},{0.2487011},{0.40791693}},{{0.09846326},{0.10953684},{0.27434307},{-0.15992385}}};
	static const float b17[1] = {0.0,0.0,0.0,0.0};

	static const float w18[2][1][1] = {{{-0.45067033}},{{-0.44080684}}};
	static const float b18[1] = {0.0};

	static const float w19[2][1][1] = {{{-0.6197068}},{{-0.6157315}}};
	static const float b19[1] = {0.0};

	static const float w20[2][2][1] = {{{-0.8249704,-0.34182197}},{{-0.13092233,-0.2512521}}};
	static const float b20[2] = {0.0};

	static const float w21[2][1][2] = {{{-0.32508025},{-0.15753652}},{{-0.4944415},{-0.02016398}}};
	static const float b21[1] = {-0.0012829601};


	const static int latency = 767;
	const static int MAX_L = MAX_BUFFER + latency;
	const static int MAX_CH = 6;
	// About 1.2e-05*(MAX_BUFFER+2) MB of buffer
	float x_even[MAX_L][MAX_CH];
	float x_odd [MAX_L][MAX_CH];



	void operator()(float* x, float* y, int L) {

		if (L > MAX_L || L <= latency) {
			return;
		}

		for (int i = 0; i < L; i++) {
			x_odd[i][0] = x[i];
		}

		//conv_nb(w, b, xi, xo, inch, ouch, ksize, inst, oust, dilation, length, maxch)
		//nonlin(xi,ch,length,st)

		conv_nb(w0, b0, x_odd, x_even, 1, 1, 2, 1, 2, 1, L-=1, MAX_CH);
		conv_nb(w1, b1, x_even, x_odd, 1, 1, 2, 2, 4, 1, L-=2, MAX_CH);
		conv_nb(w2, b2, x_odd, x_even, 1, 4, 2, 4, 4, 64, L-=256, MAX_CH);
		conv_nb(w3, b3, x_even, x_odd, 4, 4, 2, 4, 4, 32, L-=128, MAX_CH);
		conv_nb(w4, b4, x_odd, x_even, 4, 4, 2, 4, 4, 16, L-=64, MAX_CH);
		conv_nb(w5, b5, x_even, x_odd, 4, 4, 2, 4, 4, 8, L-=32, MAX_CH);
		conv_nb(w6, b6, x_odd, x_even, 4, 4, 2, 4, 4, 4, L-=16, MAX_CH);
		conv_nb(w7, b7, x_even, x_odd, 4, 4, 2, 4, 4, 2, L-=8, MAX_CH);
		conv_nb(w8, b8, x_odd, x_even, 4, 6, 1, 4, 4, 1, L-=0, MAX_CH);
		relu(x_even, 6, L, 4);
		conv_nb(w9, b9, x_even, x_odd, 6, 6, 1, 4, 4, 1, L-=0, MAX_CH);
		relu(x_odd, 6, L, 4);
		conv_nb(w10, b10, x_odd, x_even, 6, 6, 1, 4, 4, 1, L-=0, MAX_CH);
		relu(x_even, 6, L, 4);
		conv_nb(w11, b11, x_even, x_odd, 6, 6, 1, 4, 4, 1, L-=0, MAX_CH);
		relu(x_odd, 6, L, 4);
		conv_nb(w12, b12, x_odd, x_even, 6, 4, 1, 4, 4, 1, L-=0, MAX_CH);
		conv_nb(w13, b13, x_even, x_odd, 4, 4, 2, 4, 4, 32, L-=128, MAX_CH);
		conv_nb(w14, b14, x_odd, x_even, 4, 4, 2, 4, 4, 16, L-=64, MAX_CH);
		conv_nb(w15, b15, x_even, x_odd, 4, 4, 2, 4, 4, 8, L-=32, MAX_CH);
		conv_nb(w16, b16, x_odd, x_even, 4, 4, 2, 4, 4, 4, L-=16, MAX_CH);
		conv_nb(w17, b17, x_even, x_odd, 4, 1, 2, 4, 4, 2, L-=8, MAX_CH);
		conv_nb(w18, b18, x_odd, x_even, 1, 1, 2, 4, 2, 1, L-=4, MAX_CH);
		conv_nb(w19, b19, x_even, x_odd, 1, 1, 2, 2, 1, 1, L-=2, MAX_CH);
		conv_nb(w20, b20, x_odd, x_even, 1, 2, 2, 1, 1, 4, L-=4, MAX_CH);
		conv_nb(w21, b21, x_even, x_odd, 2, 1, 2, 1, 1, 2, L-=2, MAX_CH);

		// Copy result back to y
		for (int l = 0; l < L; l++) {
			y[l] = x_odd[l][0];
		}
	}
};
